<view class="container">

  <!-- Tab切换 -->
  <view class="tab-container" wx:if="{{isLoggedIn}}">
    <view class="tab-item {{activeTab === 'article' ? 'active' : ''}}" data-tab="article" bindtap="onTabChange">课文学习</view>
    <view class="tab-item {{activeTab === 'word' ? 'active' : ''}}" data-tab="word" bindtap="onTabChange">虚实词学习</view>
  </view>
  
  <!-- 未登录状态 -->
  <view class="not-login-container" wx:if="{{!isLoggedIn}}">
    <image class="not-login-image" src="/images/common/not-login.svg" mode="aspectFit"></image>
    <view class="not-login-text">请先登录查看学习历史</view>
    <button class="btn btn-primary login-btn" bindtap="goToLogin">去登录</button>
  </view>

  <!-- 已登录状态 -->
  <block wx:else>
    <!-- 加载中 - 使用微信原生加载组件 -->
    <view class="loading-wrapper" wx:if="{{loading}}">
      <view class="loading-content">
        <view class="weui-loadmore">
          <view class="weui-loading"></view>
          <view class="weui-loadmore__tips">加载中</view>
        </view>
      </view>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-container" wx:elif="{{empty}}">
      <image class="empty-image" src="/images/icons/empty.png" mode="aspectFit"></image>
      <view class="empty-text">暂无学习记录</view>
      <view class="empty-tip">快去学习一篇文章吧~</view>
    </view>
    
    <!-- 历史列表 -->
    <view wx:else>
      <!-- 课文学习历史 -->
      <view class="history-list" wx:if="{{activeTab === 'article'}}">
        <view class="history-item" wx:for="{{historyList}}" wx:key="_id" bindtap="goToArticleDetail" data-id="{{item.article.article_id || item.article_id}}">
          <view class="article-info">
            <view class="article-title">{{item.article.title || '未知文章'}}</view>
            <view class="article-author">{{item.article.author || '未知作者'}}{{item.article.dynasty ? ' · ' + item.article.dynasty : ''}}</view>
          </view>
          
          <view class="study-info">
            <view class="study-status {{item.learn_status === 2 ? 'completed' : item.learn_status === 1 ? 'learning' : ''}}">
              {{item.statusText}}
            </view>
            
            <view class="study-time">
              <text class="duration">学习时长: {{item.durationText}}</text>
              <text class="time">{{item.timeStr}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- 虚实词学习历史 -->
      <view class="history-list" wx:if="{{activeTab === 'word'}}">
        <block wx:if="{{wordHistoryList.length > 0}}">
          <view class="word-history-item" wx:for="{{wordHistoryList}}" wx:key="_id" bindtap="goToWordDetail" data-wordid="{{item.wordId}}" data-category="{{item.collection}}">
            <view class="word-info">
              <view class="word-main">
                <text class="word-text">{{item.word}}</text>
                <text class="word-pinyin" wx:if="{{item.pinyin}}">{{item.pinyin}}</text>
              </view>
              <view class="word-collection">{{item.collection}}</view>
            </view>
            <view class="word-study-info">
              <view class="word-status {{item.status}}">{{item.statusText}}</view>
              <view class="word-time">{{item.timeStr}}</view>
            </view>
          </view>
        </block>
        <view class="empty-container" wx:else>
          <image class="empty-image" src="/images/icons/empty.png" mode="aspectFit"></image>
          <view class="empty-text">暂无虚实词学习记录</view>
        </view>
      </view>
    </view>
  </block>
</view> 