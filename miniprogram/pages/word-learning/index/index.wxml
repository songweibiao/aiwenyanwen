<!-- miniprogram/pages/word-learning/index/index.wxml -->
<view class="container">
  <view class="search-section">
    <input class="search-input" placeholder="搜索虚实词..." value="{{searchValue}}" bindinput="onSearchInput" confirm-type="search" bindconfirm="onSearchConfirm" />
  </view>

  <!-- 错误信息 -->
  <view class="error-message" wx:if="{{error}}">
    <text class="error-title">错误:</text>
    <text class="error-text">{{error}}</text>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">正在加载数据...</text>
  </view>

  <!-- 登录/未登录分支 -->
  <block wx:if="{{isLoggedIn}}">
    <!-- 学习进度 -->
    <view class="section progress-section">
      <view class="section-title">学习进度（{{selectedCollection}}）</view>
      <view class="section-content progress-content">
        <text class="progress-text">已学习 {{learned}} / {{learned + toReview + inProgress}}</text>
        <view class="progress-stats">
          <view class="stat-item">
            <text class="stat-number">{{learned}}</text>
            <text class="stat-label">已掌握</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{toReview}}</text>
            <text class="stat-label">待复习</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{inProgress}}</text>
            <text class="stat-label">连续学习</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 学习分类 -->
    <view class="section category-section">
      <view class="section-title">学习分类</view>
      <view class="section-content category-grid">
        <view class="category-item {{selectedCollection == item.type ? 'selected' : ''}}" wx:for="{{categories}}" wx:key="type" data-type="{{item.type}}" bindtap="onCategoryTap">
          <view class="category-icon category-icon-{{index}}"></view>
          <view class="category-info">
            <text class="category-name">{{item.name}}</text>
            <text class="category-count">{{item.count}}个词条</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 最近学习 -->
    <view class="section recent-section">
      <view class="section-title">最近学习</view>
      <view class="section-content recent-list">
        <block wx:if="{{recentWords.length > 0}}">
          <view class="recent-item" wx:for="{{recentWords}}" wx:key="wordId">
            <text class="recent-word">{{item.word}}</text>
            <text class="recent-status">{{item.statusText}}</text>
            <text class="recent-time">{{item.timeStr}}</text>
          </view>
        </block>
        <block wx:else>
          <text class="recent-empty">暂无最近学习记录</text>
        </block>
      </view>
    </view>
  </block>

  <!-- 未登录状态 -->
  <block wx:else>
    <view class="section progress-section">
      <view class="section-title">学习进度</view>
      <view class="section-content progress-content">
        <text class="progress-text">请登录后查看学习进度</text>
        </view>
        </view>
    <view class="section category-section">
      <view class="section-title">学习分类</view>
      <view class="section-content category-grid">
        <view class="category-item" wx:for="{{categories}}" wx:key="type" data-type="{{item.type}}" bindtap="onCategoryTap">
          <view class="category-icon category-icon-{{index}}"></view>
          <view class="category-info">
            <text class="category-name">{{item.name}}</text>
            <text class="category-count">{{item.count}}个词条</text>
        </view>
        </view>
      </view>
    </view>
    <view class="section recent-section">
      <view class="section-title">最近学习</view>
      <view class="section-content recent-list">
        <text class="recent-empty">请登录后查看最近学习</text>
      </view>
    </view>
  </block>
</view>
