<!--index.wxml-->
<view class="container">
  <!-- å…¬å‘Šæ  -->
  <view wx:if="{{noticeList.length > 0}}" class="notice-bar">
    <text class="notice-icon-fixed">ğŸ“¢</text>
    <view class="marquee-wrap">
      <view
        class="marquee-content"
        style="transform: translateX({{marqueeTranslateX}}rpx); transition: all {{marqueeState === 'scroll' ? marqueeDuration : 0}}s linear;"
        catchtap="onNoticeTap"
        data-url="{{currentNotice.url}}"
      >
        <text class="notice-content">{{currentNotice.content}}</text>
        <text class="notice-gap"> </text>
      </view>
    </view>
  </view>

  <!-- æ¬¢è¿åŒºåŸŸ -->
  <view class="welcome-section">
    <image class="user-avatar" src="{{hasUserInfo ? userInfo.avatarUrl : '/miniprogram/images/default-avatar.png'}}" mode="aspectFill"></image>
    <view class="welcome-content">
      <view class="welcome-row">
        <text class="greeting">{{greeting}}ï¼Œ</text>
        <text class="nickname">{{nickname || 'åŒå­¦'}}</text>
      </view>
      <text class="slogan">æ–°çš„ä¸€å¤©ï¼Œä¸€èµ·å“è¯»ç»å…¸å§</text>
    </view>
  </view>

  <!-- æ•´åˆå¡ç‰‡åŒºåŸŸ -->
  <view class="integrated-card card">
    <!-- è¯¾å ‚åŒæ­¥å­¦ -->
    <view class="section-title flex-between">
      <text class="title-text">è¯¾å ‚åŒæ­¥å­¦</text>
      <view class="grade-selector" bindtap="changeGrade">
        <text>{{currentGrade}}</text>
        <svg class="dropdown-icon" viewBox="0 0 24 24" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
          <path fill="#6B4423" d="M7,10l5,5l5-5H7z"/>
        </svg>
      </view>
    </view>
    <view class="textbook-section">
      <view class="current-lesson">
        <text class="lesson-title">{{currentLesson}}</text>
        <view class="change-course-btn" bindtap="changeCourse">æ›´æ¢è¯¾ç¨‹</view>
      </view>
    </view>

    <view class="divider"></view>

    <!-- ä¸»è¦åŠŸèƒ½å¡ç‰‡ -->
    <view class="main-cards">
      <!-- å…¨æ–‡ç¿»è¯‘å¡ç‰‡ -->
      <view class="main-card" bindtap="goToFullTranslation">
        <view class="card-content">
          <text class="card-title">å…¨æ–‡ç¿»è¯‘</text>
          <view class="card-icon">
            <svg viewBox="0 0 24 24" width="36" height="36" xmlns="http://www.w3.org/2000/svg">
              <path fill="#6B4423" d="M12.87,15.07l-2.54-2.51l0.03-0.03c1.74-1.94,2.98-4.17,3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5,7.92,10.44,9.75,9,11.35 C8.07,10.32,7.3,9.19,6.69,8h-2c0.73,1.63,1.73,3.17,2.98,4.56l-5.09,5.02L4,19l5-5l3.11,3.11L12.87,15.07z M18.5,10h-2L12,22h2l1.12-3 h4.75L21,22h2L18.5,10z M15.88,17l1.62-4.33L19.12,17H15.88z"/>
            </svg>
          </view>
        </view>
      </view>
      
      <!-- é€å¥è§£æå¡ç‰‡ -->
      <view class="main-card" bindtap="goToSentenceAnalysis">
        <view class="card-content">
          <text class="card-title">é€å¥è§£æ</text>
          <view class="card-icon">
            <svg viewBox="0 0 24 24" width="36" height="36" xmlns="http://www.w3.org/2000/svg">
              <path fill="#6B4423" d="M21,5c-1.11-0.35-2.33-0.5-3.5-0.5c-1.95,0-4.05,0.4-5.5,1.5c-1.45-1.1-3.55-1.5-5.5-1.5S2.45,4.9,1,6v14.65 c0,0.25,0.25,0.5,0.5,0.5c0.1,0,0.15-0.05,0.25-0.05C3.1,20.45,5.05,20,6.5,20c1.95,0,4.05,0.4,5.5,1.5c1.35-0.85,3.8-1.5,5.5-1.5 c1.65,0,3.35,0.3,4.75,1.05c0.1,0.05,0.15,0.05,0.25,0.05c0.25,0,0.5-0.25,0.5-0.5V6C22.4,5.55,21.75,5.25,21,5z"/>
            </svg>
          </view>
        </view>
      </view>
    </view>

    <view class="divider"></view>

    <!-- åŠŸèƒ½å›¾æ ‡è¡Œ -->
    <view class="feature-icons">
      <view class="feature-item" bindtap="goToAuthorInfo">
        <view class="feature-icon author-icon">
          <svg viewBox="0 0 24 24" width="32" height="32" xmlns="http://www.w3.org/2000/svg">
            <path fill="#6B4423" d="M12,12c2.21,0,4-1.79,4-4s-1.79-4-4-4S8,5.79,8,8S9.79,12,12,12z M12,14c-2.67,0-8,1.34-8,4v2h16v-2C20,15.34,14.67,14,12,14z"/>
          </svg>
        </view>
        <text class="feature-text">ä½œè€…ä»‹ç»</text>
      </view>
      <view class="feature-item" bindtap="goToBackground">
        <view class="feature-icon background-icon">
          <svg viewBox="0 0 24 24" width="32" height="32" xmlns="http://www.w3.org/2000/svg">
            <path fill="#6B4423" d="M12,11.55C9.64,9.35,6.48,8,3,8v11c3.48,0,6.64,1.35,9,3.55 c2.36-2.19,5.52-3.55,9-3.55V8C17.52,8,14.36,9.35,12,11.55z M12,8c1.66,0,3-1.34,3-3s-1.34-3-3-3S9,3.34,9,5S10.34,8,12,8z"/>
          </svg>
        </view>
        <text class="feature-text">èƒŒæ™¯çŸ¥è¯†</text>
      </view>
      <view class="feature-item" bindtap="goToExercise">
        <view class="feature-icon exercise-icon">
          <svg viewBox="0 0 24 24" width="32" height="32" xmlns="http://www.w3.org/2000/svg">
            <path fill="#6B4423" d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M19,19H5V5h14V19z"/>
            <path fill="#6B4423" d="M18,9l-1.4-1.4L9,15.2L5.4,11.6L4,13l5,5L18,9z"/>
          </svg>
        </view>
        <text class="feature-text">éšå ‚ç»ƒä¹ </text>
      </view>
      <view class="feature-item" bindtap="goToAIInteraction">
        <view class="feature-icon ai-icon">
          <svg viewBox="0 0 24 24" width="32" height="32" xmlns="http://www.w3.org/2000/svg">
            <path fill="#6B4423" d="M21,8c-1.45,0-2.26,1.44-1.93,2.51l-3.55,3.56c-0.3-0.09-0.74-0.09-1.04,0l-2.55-2.55C12.27,10.45,11.46,9,10,9 c-1.45,0-2.27,1.44-1.93,2.52l-4.56,4.55C2.44,15.74,1,16.55,1,18c0,1.1,0.9,2,2,2c1.45,0,2.26-1.44,1.93-2.51l4.55-4.56 c0.3,0.09,0.74,0.09,1.04,0l2.55,2.55C12.73,16.55,13.54,18,15,18c1.45,0,2.27-1.44,1.93-2.52l3.56-3.55 C21.56,12.26,23,11.45,23,10C23,8.9,22.1,8,21,8z"/>
            <polygon fill="#6B4423" points="15,9 15.94,6.93 18,6 15.94,5.07 15,3 14.08,5.07 12,6 14.08,6.93"/>
            <polygon fill="#6B4423" points="3.5,11 4,9 6,8.5 4,8 3.5,6 3,8 1,8.5 3,9"/>
          </svg>
        </view>
        <text class="feature-text">AIäº’åŠ¨</text>
      </view>
    </view>
  </view>

  <!-- è™šå®è¯å­¦ä¹ åŒºåŸŸ -->
  <view class="word-study-card card">
    <view class="section-title flex-between">
      <text class="title-text">è™šå®è¯å­¦ä¹ </text>
      <view class="grade-selector" bindtap="changeWordType">
        <text>{{currentWordType}}</text>
        <svg class="dropdown-icon" viewBox="0 0 24 24" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
          <path fill="#6B4423" d="M7,10l5,5l5-5H7z"/>
        </svg>
      </view>
    </view>
    <view class="word-options">
      <view class="current-word-category">
        <text class="word-option-title">{{currentWordTypeName}}</text>
        <text class="word-option-count">{{currentWordType === 'ä¸­è€ƒ' ? 'å…±124ä¸ª' : 'å…±186ä¸ª'}}</text>
        <view class="change-course-btn" bindtap="changeWordType">æ›´æ¢è¯¾ç¨‹</view>
      </view>
    </view>
    <view class="word-action">
      <view class="word-btn word-learn-btn" bindtap="goToWordStudy">å­¦ä¹ </view>
      <view class="word-btn word-practice-btn" bindtap="goToWordPractice">ç»ƒä¹ </view>
    </view>
  </view>

  <!-- åå¥èµæå¡ç‰‡ -->
  <view class="quote-section card" wx:if="{{famousQuote}}">
    <view class="section-title flex-between">
      <text class="title-text">æ¯æ—¥åå¥</text>
      <view class="quote-actions">
        <view class="action-icon" bindtap="refreshQuote">
          <svg viewBox="0 0 24 24" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
            <path fill="#6B4423" d="M17.65,6.35C16.2,4.9,14.21,4,12,4c-4.42,0-7.99,3.58-7.99,8s3.57,8,7.99,8c3.73,0,6.84-2.55,7.73-6h-2.08c-0.82,2.33-3.04,4-5.65,4c-3.31,0-6-2.69-6-6s2.69-6,6-6c1.66,0,3.14,0.69,4.22,1.78L13,11h7V4L17.65,6.35z"/>
          </svg>
        </view>
        <view class="action-icon" bindtap="collectQuote">
          <svg viewBox="0 0 24 24" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
            <path fill="#6B4423" d="M17,3H7c-1.1,0-1.99,0.9-1.99,2L5,21l7-3l7,3V5C19,3.9,18.1,3,17,3z"/>
          </svg>
        </view>
      </view>
    </view>
    <view class="quote-content" bindtap="goToQuoteDetail">
      <text class="quote-text">{{famousQuote.content}}</text>
      <view class="quote-source text-light">â€”â€”{{famousQuote.dynasty}} Â· {{famousQuote.author}}ã€Š{{famousQuote.source}}ã€‹</view>
      <view class="quote-translation">{{famousQuote.translation}}</view>
    </view>
  </view>

  <!-- æ¨å¹¿é¢†å–åŒºåŸŸ -->
  <view class="promotion-section" bindtap="goToPromotion">
    <view class="promotion-banner">
      <text class="promotion-title">æ–‡è¨€æ–‡å­¦ä¹ èµ„æ–™</text>
      <text class="promotion-desc">ç‚¹å‡»å¤åˆ¶æ¨å¹¿ç ï¼Œå…³æ³¨å…¬ä¼—å·é¢†å–</text>
      <view class="promotion-button">ç«‹å³é¢†å–</view>
    </view>
  </view>
</view> 