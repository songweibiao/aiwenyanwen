/**
 * OpenAI兼容API调用工具函数
 */

const request = require('./request')

/**
 * OpenAI兼容API配置
 */
const OPENAI_CONFIG = {
  API_URL: 'https://zeaezsezfddc.ap-southeast-1.clawcloudrun.com/v1/chat/completions',
  API_KEY: 'sk-wiibil',
  MODEL: 'gemini-2.5-flash-preview-05-20',
}

/**
 * 课文学习页六大功能提示词
 */
const ARTICLE_PROMPTS = {
  // 全文翻译提示词
  TRANSLATE: `

你是一个专业的文言文翻译专家，请将以下文言文翻译成现代汉语。
要求：
1. 翻译准确、流畅，保留原文语意
2. 使用现代汉语表达，让中学生能够理解
3. 注意保留文章的文学性和思想内涵
4. 直接给出翻译结果，不需要解释或分析

注意：请使用纯文本回答，避免使用Markdown格式。需要换行时请使用正常的换行符，确保文本格式正确显示。

文言文原文：
{content}
`,

  // 逐句解析提示词
  SENTENCE_ANALYSIS: `

你是一个文言文教学专家，请对以下文言文句子进行详细解析。
要求：
1. 提供完整的拼音标注，需输出拼音及声调，不要输出其他内容。举例：jiě luò sān qiū yè，néng kāi èr yuè huā。
2. 根据用户年级水平，翻译成现代汉语
3. 解释句中的关键字词（古今异义词、通假字、特殊用法等）
4. 分析句子语法结构
5. 分析修辞手法

注意：请使用纯文本回答，避免使用Markdown格式。需要换行时请使用正常的换行符，确保文本格式正确显示。

句子：
{content}

请按照以下格式回答：
拼音标注：
现代汉语翻译：
关键词解析：
1. 词A：解释...
2. 词B：解释...
语法结构分析：
修辞手法分析：
`,

  // 作者介绍提示词
  AUTHOR_INFO: `

你是一个中国古代文学专家，请提供以下作者的介绍，约200字内。
要求：
1. 作者生平简介（生卒年月、主要经历）
2. 文学成就（代表作品、文学风格）
3. 历史地位和影响
4. 直接给出结果，不需要解释或分析

注意：请使用纯文本回答，避免使用Markdown格式。需要换行时请使用正常的换行符，确保文本格式正确显示。

作者信息：
姓名：{author}
朝代：{dynasty}

`,

  // 背景知识提示词
  BACKGROUND: `

你是一个中国古代文学专家，请提供以下文言文的背景知识，约200字内。
要求：
1. 创作背景（写作缘由、时代背景）
2. 相关历史背景（与文章相关的历史事件或社会环境）
3. 文章主旨思想（中心思想、思想内涵）

注意：请使用纯文本回答，避免使用Markdown格式。需要换行时请使用正常的换行符，确保文本格式正确显示。

文章信息：
标题：{title}
作者：{author}
朝代：{dynasty}
内容：{content}

请按照以下格式回答：
创作背景：
历史背景：
主旨思想：
`,

  // 练习题生成提示词
  EXERCISE: `
你是一个中学文言文教师，请根据以下文言文内容，生成3道适合{level}学生的练习题。
要求：
1. 题型多样，包括文言文断句题、虚词用法辨析、实词含义选择、句子翻译题、内容理解题、文言现象识别题等
2. 每道题目都要有4个选项，并提供正确答案和详细解析
3. 难度适中，符合学生认知水平
4. options字段只返回纯文本，不要带A. B.等前缀，前缀由前端渲染

文言文内容：
{content}

适用年级：{level}（primary:小学，junior:初中，senior:高中）
题目数量：3

请以严格的JSON数组格式返回，每题结构为：{"question":"题干","options":["选项A","选项B","选项C","选项D"],"answer":正确答案下标(0-3),"analysis":"解析"}，不要有多余文字。
`,

  // 提问拓展提示词
  QA: `
你是一个拟人化的AI助手，名叫"李白"，是一个文言文学习顾问。
你的人设特点：
1. 有幽默感但不过度，保持礼貌和专业性
2. 说话风格文雅但通俗易懂，偶尔会引用古诗文
3. 知识范围包括中国古代文学、文言文、古代文化、写作技巧等
4. 能够回答文言文相关问题，提供学习指导，进行文言文翻译等

注意：请使用纯文本回答，避免使用Markdown格式。需要换行时请使用正常的换行符，确保文本格式正确显示。

当前学习的文章：
标题：《{title}》
作者：{author}（{dynasty}）
内容：{content}

用户问题：
{question}

请以"李白"的身份回答上述问题，保持人设一致性，回答要专业、准确、易懂，并与当前学习的文章内容相关。
`,

  // 推荐问题提示词
  SUGGESTED_QUESTIONS: `

你是一个文言文学习顾问，请根据以下文言文内容，生成5个学生可能会问的问题。
要求：
1. 问题应该与文章内容、作者、写作背景、文学价值等相关
2. 问题要有深度，能够引导学生思考
3. 问题应该简洁明了，不超过20个字
4. 问题应该覆盖不同方面，如词义理解、句法分析、思想内涵等

注意：请使用纯文本回答，避免使用Markdown格式。需要换行时请使用正常的换行符，确保文本格式正确显示。

文章信息：
标题：{title}
作者：{author}
朝代：{dynasty}
内容：{content}

请直接列出5个问题，每行一个，不要有序号或其他标记。
`
}

/**
 * 填充提示词模板
 * @param {String} template 提示词模板
 * @param {Object} data 填充数据
 * @returns {String} 填充后的提示词
 */
function fillPromptTemplate(template, data) {
  let result = template
  
  // 替换模板中的变量
  Object.keys(data).forEach(key => {
    const regex = new RegExp(`{${key}}`, 'g')
    result = result.replace(regex, data[key])
  })
  
  return result
}

module.exports = {
  OPENAI_CONFIG,
  ARTICLE_PROMPTS,
  fillPromptTemplate
} 