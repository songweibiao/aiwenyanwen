<!-- miniprogram/pages/word-learning/index/index.wxml -->
<view class="container">
  <!-- 错误信息 -->
  <view class="error-message" wx:if="{{error}}">
    <text class="error-title">错误:</text>
    <text class="error-text">{{error}}</text>
  </view>

  <!-- 登录/未登录分支 -->
  <block wx:if="{{isLoggedIn}}">
    <!-- 学习进度卡片 -->
    <view class="progress-card card">
      <view class="card-header">
        <view class="card-title">
          <image class="icon-title" src="/images/icons/progress.svg" mode="aspectFit"/>
          <text class="title-text">学习进度</text>
        </view>
        <view class="collection-selector">
          <text class="collection-name">{{selectedCollection}}</text>
        </view>
      </view>
      
      <view class="progress-bar">
        <view class="progress-inner" style="width: {{(learned / (learned + toReview + inProgress + toLearn)) * 100 || 0}}%"></view>
      </view>
      
      <view class="progress-stats">
        <view class="stat-item">
          <text class="stat-number">{{learned}}</text>
          <text class="stat-label">已掌握</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{toReview}}</text>
          <text class="stat-label">待复习</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{inProgress}}</text>
          <text class="stat-label">学习中</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{toLearn}}</text>
          <text class="stat-label">待学习</text>
        </view>
      </view>
    </view>

    <!-- 学习分类 -->
    <view class="categories-card card">
      <view class="card-header">
        <view class="card-title">
          <image class="icon-title" src="/images/icons/category.svg" mode="aspectFit"/>
          <text class="title-text">学习分类</text>
        </view>
      </view>
      
      <view class="category-grid">
        <view class="category-item {{selectedCollection == item.type ? 'selected' : ''}}" 
              wx:for="{{categories}}" 
              wx:key="type" 
              data-type="{{item.type}}" 
              bindtap="onCategoryTap">
          <view class="category-icon category-icon-{{index}}">
            <image wx:if="{{index === 0}}" class="category-icon-img" src="/images/icons/high-real.svg" mode="aspectFit"></image>
            <image wx:elif="{{index === 1}}" class="category-icon-img" src="/images/icons/high-virtual.svg" mode="aspectFit"></image>
            <image wx:elif="{{index === 2}}" class="category-icon-img" src="/images/icons/middle-real.svg" mode="aspectFit"></image>
            <image wx:else class="category-icon-img" src="/images/icons/middle-virtual.svg" mode="aspectFit"></image>
          </view>
          <view class="category-info">
            <text class="category-name">{{item.name}}</text>
            <text class="category-count">{{item.count}}个词条</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 每日一词 -->
    <view class="daily-word-card card" bindtap="viewWordDetail" data-word-id="{{dailyWord._id}}">
      <view class="card-header">
        <view class="card-title">
          <image class="icon-title" src="/images/icons/word.svg" mode="aspectFit"/>
          <text class="title-text">每日一词</text>
        </view>
        <view class="refresh-btn" catchtap="refreshDailyWord">
          <text class="refresh-text">换一个</text>
        </view>
      </view>
      
      <view class="daily-word-content">
        <view class="daily-word-loading" wx:if="{{!dailyWord}}">
          <text>加载中...</text>
        </view>
        <block wx:else>
          <!-- 词语展示区 -->
          <view class="word-row">
            <view class="word-container">
              <text class="daily-word-text">{{dailyWord.word}}</text>
              <view class="word-decoration"></view>
            </view>
            <view class="word-info">
              <text class="daily-word-pinyin" wx:if="{{dailyWord.pinyin}}">{{dailyWord.pinyin}}</text>
              <view class="tag-meaning">
                <text class="tag">词义</text>
                <text class="meaning-text">{{dailyWord.explanation}}</text>
              </view>
            </view>
          </view>
          
          <!-- 例句展示区 -->
          <view class="example-section" wx:if="{{dailyWord.example}}">
            <view class="example-content">
              <text class="tag example-tag">例</text>
              <text class="example-text">{{dailyWord.example}}</text>
            </view>
            
            <!-- 出处 -->
            <view class="source-line" wx:if="{{dailyWord.exampleSource}}">
              <text>—— {{dailyWord.exampleSource}}</text>
            </view>
            
            <!-- 译文 -->
            <view class="translation" wx:if="{{dailyWord.exampleTranslation}}">
              <text class="translation-prefix">译</text>
              <text class="translation-text">{{dailyWord.exampleTranslation}}</text>
            </view>
          </view>
        </block>
      </view>
    </view>
  </block>

  <!-- 未登录状态 -->
  <block wx:else>
    <view class="login-card card">
      <view class="login-content">
        <image class="login-image" src="/images/icons/empty.png" mode="aspectFit"></image>
        <text class="login-title">请登录后查看学习进度</text>
        <text class="login-subtitle">登录后可以保存学习记录和进度</text>
        <button class="login-btn" bindtap="navigateToMyPage">去登录</button>
      </view>
    </view>
    
    <view class="categories-card card">
      <view class="card-header">
        <view class="card-title">
          <image class="icon-title" src="/images/icons/category.svg" mode="aspectFit"/>
          <text class="title-text">学习分类</text>
        </view>
      </view>
      
      <view class="category-grid">
        <view class="category-item" 
              wx:for="{{categories}}" 
              wx:key="type" 
              data-type="{{item.type}}" 
              bindtap="onCategoryTap">
          <view class="category-icon category-icon-{{index}}">
            <image wx:if="{{index === 0}}" class="category-icon-img" src="/images/icons/high-real.svg" mode="aspectFit"></image>
            <image wx:elif="{{index === 1}}" class="category-icon-img" src="/images/icons/high-virtual.svg" mode="aspectFit"></image>
            <image wx:elif="{{index === 2}}" class="category-icon-img" src="/images/icons/middle-real.svg" mode="aspectFit"></image>
            <image wx:else class="category-icon-img" src="/images/icons/middle-virtual.svg" mode="aspectFit"></image>
          </view>
          <view class="category-info">
            <text class="category-name">{{item.name}}</text>
            <text class="category-count">{{item.count}}个词条</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 未登录状态的每日一词 -->
    <view class="daily-word-card card" bindtap="viewWordDetail" data-word-id="{{dailyWord._id}}">
      <view class="card-header">
        <view class="card-title">
          <image class="icon-title" src="/images/icons/word.svg" mode="aspectFit"/>
          <text class="title-text">每日一词</text>
        </view>
        <view class="refresh-btn" catchtap="refreshDailyWord">
          <text class="refresh-text">换一个</text>
        </view>
      </view>
      
      <view class="daily-word-content">
        <view class="daily-word-loading" wx:if="{{!dailyWord}}">
          <text>加载中...</text>
        </view>
        <block wx:else>
          <!-- 词语展示区 -->
          <view class="word-row">
            <view class="word-container">
              <text class="daily-word-text">{{dailyWord.word}}</text>
              <view class="word-decoration"></view>
            </view>
            <view class="word-info">
              <text class="daily-word-pinyin" wx:if="{{dailyWord.pinyin}}">{{dailyWord.pinyin}}</text>
              <view class="tag-meaning">
                <text class="tag">词义</text>
                <text class="meaning-text">{{dailyWord.explanation}}</text>
              </view>
            </view>
          </view>
          
          <!-- 例句展示区 -->
          <view class="example-section" wx:if="{{dailyWord.example}}">
            <view class="example-content">
              <text class="tag example-tag">例</text>
              <text class="example-text">{{dailyWord.example}}</text>
            </view>
            
            <!-- 出处 -->
            <view class="source-line" wx:if="{{dailyWord.exampleSource}}">
              <text>—— {{dailyWord.exampleSource}}</text>
            </view>
            
            <!-- 译文 -->
            <view class="translation" wx:if="{{dailyWord.exampleTranslation}}">
              <text class="translation-prefix">译</text>
              <text class="translation-text">{{dailyWord.exampleTranslation}}</text>
            </view>
          </view>
          
          <view class="daily-word-footer">
            <text class="login-tip">登录后可查看更多分类词条</text>
          </view>
        </block>
      </view>
    </view>
  </block>
</view>
