<!--index.wxml-->
<wxs src="../../utils/filters.wxs" module="filters" />
<view class="container">
  <!-- å…¬å‘Šæ  -->
  <view class="notice-bar" wx:if="{{noticeList.length > 0 && !noticeClosed}}">
    <text class="notice-icon">ğŸ“¢</text>
    <view class="marquee-wrap">
      <view
        class="marquee-content"
        style="transform: translateX({{marqueeTranslateX}}rpx); transition: all {{marqueeState === 'scroll' ? marqueeDuration : 0}}s linear;"
        catchtap="onNoticeTap"
        data-url="{{currentNotice.url}}"
      >
        <text class="notice-content">{{currentNotice.content}}</text>
        <text class="notice-gap"> </text>
      </view>
    </view>
    <view class="notice-close" bindtap="closeNotice">Ã—</view>
  </view>

  <!-- æ¬¢è¿åŒºåŸŸ -->
  <view class="welcome-card card" bindtap="onWelcomeCardTap">
    <view class="welcome-content">
      <view class="user-info">
        <image class="user-avatar" src="{{hasUserInfo ? userInfo.avatarUrl : '/images/default-avatar.png'}}" mode="aspectFill"></image>
        <view class="welcome-text">
          <view class="welcome-greeting">
            <text class="greeting text-secondary">{{greeting}}ï¼Œ</text>
            <text class="nickname text-primary-color text-bold">{{nickname || 'åŒå­¦'}}</text>
          </view>
          <text class="slogan text-tertiary">æ–°çš„ä¸€å¤©ï¼Œä¸€èµ·å“è¯»ç»å…¸å§</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯¾å ‚åŒæ­¥å­¦åŒºåŸŸ -->
  <view class="study-card card">
    <view class="card-header">
      <view class="card-title">
        <image class="icon-title" src="/images/icons/classroom.svg" mode="aspectFit"/>
        <text class="title-text">è¯¾å ‚åŒæ­¥å­¦</text>
      </view>
      <view class="grade-indicator" wx:if="{{hasSelectedCourse}}">
        <text class="grade-text text-primary-color">{{currentGrade}}</text>
      </view>
    </view>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-section" wx:if="{{courseLoading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    
    <!-- æœªé€‰æ‹©è¯¾æ–‡æ—¶æ˜¾ç¤ºå¼€å§‹å­¦ä¹ åŒºåŸŸ -->
    <view class="empty-study-section" wx:elif="{{!hasSelectedCourse}}">
      <image class="empty-course-image" src="/images/common/empty-course.svg" mode="aspectFit"></image>
      <view class="empty-course-text text-lg text-bold">å¼€å¯æ–‡è¨€æ–‡å­¦ä¹ ä¹‹æ—…</view>
      <view class="empty-course-subtext text-secondary">é€‰æ‹©è¯¾æ–‡åå³å¯äº«å—å…¨é¢å­¦ä¹ ä½“éªŒ</view>
      <view class="btn btn-primary start-btn" bindtap="startLearning">
        <view class="start-btn-content">
          <image class="start-btn-icon" src="/images/common/book-icon.svg" mode="aspectFit"></image>
          <text>ç«‹å³é€‰æ‹©è¯¾æ–‡</text>
        </view>
        <view class="arrow-icon">
          <view class="arrow-right"></view>
        </view>
      </view>
    </view>
    
    <!-- å·²é€‰æ‹©è¯¾æ–‡æ—¶æ˜¾ç¤ºè¯¾æ–‡ä¿¡æ¯ -->
    <view class="study-content" wx:else>
      <view class="current-lesson">
        <view class="lesson-info">
          <text class="lesson-title text-bold">{{currentLesson}}</text>
          <view class="lesson-author" wx:if="{{selectedCourse.article.author || selectedCourse.article.dynasty}}">
            <text>{{selectedCourse.article.dynasty || ''}} Â· {{selectedCourse.article.author || ''}}</text>
          </view>
        </view>
        <view class="btn btn-secondary btn-xs change-btn" bindtap="changeCourse">
          <image class="change-icon" src="/images/icons/refresh.svg" mode="aspectFit"></image>
          <text>æ›´æ¢è¯¾ç¨‹</text>
        </view>
      </view>

      <!-- éŸ³é¢‘æ’­æ”¾å™¨æ¨¡å— -->
      <view wx:if="{{selectedCourse.article.audio}}" class="audio-player-card">
        <view class="audio-header-row">
          <text class="audio-title">AIæ’­å®¢è¶£è§£</text>
          <view class="audio-speed-group">
            <block wx:for="{{audioSpeedList}}" wx:key="item">
              <view class="audio-speed-btn {{audioSpeed==item?'active':''}}" data-speed="{{item}}" bindtap="onAudioSpeedChange">{{item}}x</view>
            </block>
          </view>
        </view>
        
        <view class="audio-main">
          <view class="audio-btn-play {{audioPlaying?'playing':''}}" bindtap="{{audioPlaying?'onAudioPause':'onAudioPlay'}}">
            <view class="play-icon"></view>
            <view class="pause-icon"></view>
          </view>
          
          <view class="audio-progress-wrap">
            <view class="audio-progress-bar">
              <slider 
                class="audio-slider" 
                min="0" 
                max="{{audioDuration}}" 
                step="0.1" 
                value="{{audioCurrent}}" 
                activeColor="#8B6E4F"
                backgroundColor="rgba(139, 110, 79, 0.1)"
                block-size="12"
                block-color="#8B6E4F"
                bindchange="onAudioSliderChange"
              />
            </view>
            <view class="audio-time-row">
              <text class="audio-time-current">{{filters.formatAudioTime(audioCurrent)}}</text>
              <text class="audio-time-total">{{filters.formatAudioTime(audioDuration)}}</text>
            </view>
          </view>
        </view>
        
        <view class="audio-disclaimer">
          <text>æ’­å®¢å†…å®¹ç”±AIç”Ÿæˆï¼Œå‘éŸ³æœªå¿…å‡†ç¡®ï¼Œè¯·ä»”ç»†è¾¨åˆ«ã€‚</text>
        </view>
      </view>

      <view class="divider"></view>

      <!-- ä¸»è¦åŠŸèƒ½å¡ç‰‡ -->
      <view class="feature-row">
        <view class="feature-card" bindtap="goToFullTranslation">
          <view class="feature-icon">
            <image src="/images/icons/translation.svg" mode="aspectFit"></image>
          </view>
          <text class="feature-title">å…¨æ–‡ç¿»è¯‘</text>
          <image class="feature-bg" src="/images/common/chinese-pattern-1.svg" mode="aspectFill"></image>
        </view>
        
        <view class="feature-spacing"></view>
        
        <view class="feature-card" bindtap="goToSentenceAnalysis">
          <view class="feature-icon">
            <image src="/images/icons/analysis.svg" mode="aspectFit"></image>
          </view>
          <text class="feature-title">é€å¥è§£æ</text>
          <image class="feature-bg" src="/images/common/chinese-pattern-2.svg" mode="aspectFill"></image>
        </view>
      </view>

      <view class="divider"></view>

      <!-- åŠŸèƒ½å›¾æ ‡è¡Œ -->
      <view class="tool-grid">
        <view class="tool-item" bindtap="goToAuthorInfo">
          <view class="tool-icon author-icon">
            <image src="/images/icons/author.svg" mode="aspectFit"></image>
          </view>
          <text class="tool-text">ä½œè€…ä»‹ç»</text>
        </view>
        <view class="tool-item" bindtap="goToBackground">
          <view class="tool-icon background-icon">
            <image src="/images/icons/background.svg" mode="aspectFit"></image>
          </view>
          <text class="tool-text">èƒŒæ™¯çŸ¥è¯†</text>
        </view>
        <view class="tool-item" bindtap="goToExercise">
          <view class="tool-icon exercise-icon">
            <image src="/images/icons/exercise.svg" mode="aspectFit"></image>
          </view>
          <text class="tool-text">ç»ƒä¹ å·©å›º</text>
        </view>
        <view class="tool-item" bindtap="goToAIInteraction">
          <view class="tool-icon ai-icon">
            <image src="/images/icons/ai.svg" mode="aspectFit"></image>
          </view>
          <text class="tool-text">AIäº’åŠ¨</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è™šå®è¯å­¦ä¹ åŒºåŸŸ -->
  <view class="word-card card">
    <view class="card-header">
      <view class="card-title">
        <image class="icon-title" src="/images/icons/word.svg" mode="aspectFit"/>
        <text class="title-text">è™šå®è¯å­¦ä¹ </text>
      </view>
      <view class="word-selector" bindtap="changeWordType">
        <text class="word-type text-primary-color">{{currentWordType}}</text>
        <view class="dropdown-icon">
          <view class="arrow-down"></view>
        </view>
      </view>
    </view>
    
    <view class="word-type-info">
      <view class="word-type-content">
        <text class="word-type-name text-bold">{{currentWordTypeName}}</text>
        <text class="word-count text-tertiary">{{currentWordType === 'ä¸­è€ƒ' ? 'å…±124ä¸ª' : 'å…±186ä¸ª'}}</text>
      </view>
      <view class="btn btn-secondary btn-xs change-btn" bindtap="changeWordType">
        <image class="change-icon" src="/images/icons/refresh.svg" mode="aspectFit"></image>
        <text>æ›´æ¢è¯¾ç¨‹</text>
      </view>
    </view>
    
    <view class="word-actions">
      <view class="btn btn-primary word-btn" bindtap="goToWordStudy">å­¦ä¹ </view>
      <view class="btn btn-secondary word-btn" bindtap="goToWordPractice">ç»ƒä¹ </view>
    </view>
  </view>

  <!-- åå¥èµæå¡ç‰‡ -->
  <view class="quote-card card" wx:if="{{famousQuote}}">
    <view class="card-header">
      <view class="card-title">
        <image class="icon-title" src="/images/icons/quote.svg" mode="aspectFit"/>
        <text class="title-text">æ¯æ—¥åå¥</text>
      </view>
      <view class="quote-actions">
        <view class="icon-btn" bindtap="refreshQuote">
          <image src="/images/icons/refresh.svg" mode="aspectFit" class="action-icon"></image>
        </view>
        <view class="icon-btn" bindtap="collectQuote">
          <image src="{{famousQuote.isCollected ? '/images/icons/star-filled.svg' : '/images/icons/star.svg'}}" mode="aspectFit" class="action-icon {{famousQuote.isCollected ? 'collected' : ''}}"></image>
        </view>
      </view>
    </view>
    
    <view class="quote-content" bindtap="goToQuoteDetail">
      <text class="quote-text">{{famousQuote.content}}</text>
      <view class="quote-source text-tertiary">â€”â€”{{famousQuote.dynasty}} Â· {{famousQuote.author}}ã€Š{{famousQuote.source}}ã€‹</view>
      <view class="quote-translation">{{famousQuote.translation}}</view>
    </view>
  </view>

  <!-- æ¨å¹¿é¢†å–åŒºåŸŸ -->
  <view class="promo-card" bindtap="goToPromotion">
    <view class="promo-content">
      <view class="promo-info">
        <text class="promo-title">æ–‡è¨€æ–‡å­¦ä¹ èµ„æ–™</text>
        <text class="promo-desc">ç‚¹å‡»å¤åˆ¶æ¨å¹¿ç ï¼Œå…³æ³¨å…¬ä¼—å·é¢†å–</text>
      </view>
      <view class="btn btn-light promo-btn">ç«‹å³é¢†å–</view>
    </view>
  </view>
</view> 